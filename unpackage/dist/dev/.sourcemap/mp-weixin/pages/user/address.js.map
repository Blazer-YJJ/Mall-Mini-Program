{"version":3,"file":"address.js","sources":["pages/user/address.vue","D:/install_project/HBuilderX.4.29.2024093009/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9hZGRyZXNzLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"address-container\">\n    <!-- 地址列表 -->\n    <view class=\"address-list\" v-if=\"addressList.length > 0\">\n      <view \n        class=\"address-item\" \n        v-for=\"(item, index) in addressList\" \n        :key=\"index\"\n        @click=\"selectMode ? selectAddress(item) : editAddress(item)\"\n      >\n        <view class=\"address-info\">\n          <view class=\"user-info\">\n            <text class=\"name\">{{ item.name }}</text>\n            <text class=\"phone\">{{ item.phone }}</text>\n            <text class=\"tag\" v-if=\"item.isDefault\">默认</text>\n          </view>\n          <view class=\"address-detail\">\n            {{ item.province }} {{ item.city }} {{ item.district }} {{ item.address }}\n          </view>\n        </view>\n        <view class=\"action-box\" @click.stop=\"showActionSheet(item, index)\">\n          <u-icon name=\"more-dot-fill\" color=\"#ccc\" size=\"40\"></u-icon>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 空状态 -->\n    <view class=\"empty\" v-else>\n      <u-empty text=\"暂无收货地址\" mode=\"address\"></u-empty>\n    </view>\n    \n    <!-- 底部按钮 -->\n    <view class=\"bottom-btn\">\n      <u-button type=\"primary\" @click=\"addAddress\">新增收货地址</u-button>\n    </view>\n    \n    <!-- 地址编辑弹窗 -->\n    <u-popup v-model=\"showEditPopup\" mode=\"bottom\" border-radius=\"16\">\n      <view class=\"popup-content\">\n        <view class=\"popup-header\">\n          <text>{{ editingAddress.id ? '编辑地址' : '新增地址' }}</text>\n          <u-icon name=\"close\" @click=\"showEditPopup = false\"></u-icon>\n        </view>\n        <view class=\"form-box\">\n          <u-form :model=\"editingAddress\" ref=\"uForm\">\n            <u-form-item label=\"收货人\">\n              <u-input v-model=\"editingAddress.name\" placeholder=\"请输入收货人姓名\" />\n            </u-form-item>\n            <u-form-item label=\"手机号码\">\n              <u-input v-model=\"editingAddress.phone\" placeholder=\"请输入手机号码\" />\n            </u-form-item>\n            <u-form-item label=\"所在地区\">\n              <view class=\"region-select\" @click=\"showRegionPicker = true\">\n                <text v-if=\"editingAddress.province\">\n                  {{ editingAddress.province }} {{ editingAddress.city }} {{ editingAddress.district }}\n                </text>\n                <text v-else class=\"placeholder\">请选择所在地区</text>\n                <u-icon name=\"arrow-right\" color=\"#ccc\"></u-icon>\n              </view>\n            </u-form-item>\n            <u-form-item label=\"详细地址\">\n              <u-input v-model=\"editingAddress.address\" placeholder=\"请输入详细地址\" />\n            </u-form-item>\n            <u-form-item label=\"设为默认地址\">\n              <u-switch v-model=\"editingAddress.isDefault\"></u-switch>\n            </u-form-item>\n          </u-form>\n          <view class=\"btn-group\">\n            <u-button type=\"primary\" @click=\"saveAddress\">保存</u-button>\n          </view>\n        </view>\n      </view>\n    </u-popup>\n    \n    <!-- 地区选择器 -->\n    <u-picker v-model=\"showRegionPicker\" mode=\"region\" @confirm=\"confirmRegion\"></u-picker>\n  </view>\n</template>\n\n<script>\nimport { mapState, mapMutations } from 'vuex'\n\nexport default {\n  data() {\n    return {\n      selectMode: false,\n      showEditPopup: false,\n      showRegionPicker: false,\n      editingAddress: {\n        id: null,\n        name: '',\n        phone: '',\n        province: '',\n        city: '',\n        district: '',\n        address: '',\n        isDefault: false\n      }\n    }\n  },\n  computed: {\n    ...mapState(['addressList'])\n  },\n  onLoad(options) {\n    if (options.select) {\n      this.selectMode = true\n    }\n    \n    // 如果没有地址数据，添加一些模拟数据\n    if (this.addressList.length === 0) {\n      this.initMockData()\n    }\n  },\n  methods: {\n    ...mapMutations(['setAddressList']),\n    initMockData() {\n      const mockAddressList = [\n        {\n          id: 1,\n          name: '张三',\n          phone: '13800138000',\n          province: '广东省',\n          city: '深圳市',\n          district: '南山区',\n          address: '科技园南路XX号',\n          isDefault: true\n        },\n        {\n          id: 2,\n          name: '李四',\n          phone: '13900139000',\n          province: '广东省',\n          city: '广州市',\n          district: '天河区',\n          address: '天河路XX号',\n          isDefault: false\n        }\n      ]\n      this.setAddressList(mockAddressList)\n    },\n    addAddress() {\n      this.editingAddress = {\n        id: null,\n        name: '',\n        phone: '',\n        province: '',\n        city: '',\n        district: '',\n        address: '',\n        isDefault: false\n      }\n      this.showEditPopup = true\n    },\n    editAddress(address) {\n      this.editingAddress = JSON.parse(JSON.stringify(address))\n      this.showEditPopup = true\n    },\n    saveAddress() {\n      // 简单验证\n      if (!this.editingAddress.name) {\n        uni.showToast({\n          title: '请输入收货人姓名',\n          icon: 'none'\n        })\n        return\n      }\n      if (!this.editingAddress.phone) {\n        uni.showToast({\n          title: '请输入手机号码',\n          icon: 'none'\n        })\n        return\n      }\n      if (!this.editingAddress.province) {\n        uni.showToast({\n          title: '请选择所在地区',\n          icon: 'none'\n        })\n        return\n      }\n      if (!this.editingAddress.address) {\n        uni.showToast({\n          title: '请输入详细地址',\n          icon: 'none'\n        })\n        return\n      }\n      \n      const newAddressList = [...this.addressList]\n      \n      // 如果设置为默认地址，需要将其他地址设为非默认\n      if (this.editingAddress.isDefault) {\n        newAddressList.forEach(item => {\n          item.isDefault = false\n        })\n      }\n      \n      if (this.editingAddress.id) {\n        // 编辑现有地址\n        const index = newAddressList.findIndex(item => item.id === this.editingAddress.id)\n        if (index > -1) {\n          newAddressList[index] = this.editingAddress\n        }\n      } else {\n        // 添加新地址\n        const newId = newAddressList.length > 0 ? Math.max(...newAddressList.map(item => item.id)) + 1 : 1\n        newAddressList.push({\n          ...this.editingAddress,\n          id: newId\n        })\n      }\n      \n      this.setAddressList(newAddressList)\n      this.showEditPopup = false\n      \n      uni.showToast({\n        title: '保存成功',\n        icon: 'success'\n      })\n    },\n    confirmRegion(e) {\n      const { province, city, area } = e\n      this.editingAddress.province = province.label\n      this.editingAddress.city = city.label\n      this.editingAddress.district = area.label\n    },\n    showActionSheet(address, index) {\n      uni.showActionSheet({\n        itemList: ['编辑', '删除', address.isDefault ? '取消默认' : '设为默认'],\n        success: (res) => {\n          switch (res.tapIndex) {\n            case 0: // 编辑\n              this.editAddress(address)\n              break\n            case 1: // 删除\n              this.deleteAddress(index)\n              break\n            case 2: // 设为默认/取消默认\n              this.toggleDefault(index)\n              break\n          }\n        }\n      })\n    },\n    deleteAddress(index) {\n      uni.showModal({\n        title: '提示',\n        content: '确定要删除该地址吗？',\n        success: (res) => {\n          if (res.confirm) {\n            const newAddressList = [...this.addressList]\n            newAddressList.splice(index, 1)\n            this.setAddressList(newAddressList)\n            \n            uni.showToast({\n              title: '删除成功',\n              icon: 'success'\n            })\n          }\n        }\n      })\n    },\n    toggleDefault(index) {\n      const newAddressList = [...this.addressList]\n      const isCurrentDefault = newAddressList[index].isDefault\n      \n      // 如果当前已是默认，则取消默认\n      if (isCurrentDefault) {\n        newAddressList[index].isDefault = false\n      } else {\n        // 否则将当前设为默认，其他取消默认\n        newAddressList.forEach((item, i) => {\n          item.isDefault = i === index\n        })\n      }\n      \n      this.setAddressList(newAddressList)\n    },\n    selectAddress(address) {\n      // 在选择模式下，选中地址后返回上一页\n      const pages = getCurrentPages()\n      const prevPage = pages[pages.length - 2]\n      \n      // 设置上一页的选中地址\n      if (prevPage && prevPage.$vm) {\n        prevPage.$vm.selectedAddress = address\n      }\n      \n      uni.navigateBack()\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.address-container {\n  min-height: 100vh;\n  background-color: #f8f8f8;\n  padding-bottom: 120rpx;\n  \n  .address-list {\n    padding: 20rpx;\n    \n    .address-item {\n      display: flex;\n      align-items: center;\n      background-color: #fff;\n      border-radius: 12rpx;\n      padding: 30rpx;\n      margin-bottom: 20rpx;\n      \n      .address-info {\n        flex: 1;\n        \n        .user-info {\n          margin-bottom: 10rpx;\n          \n          .name {\n            font-size: 32rpx;\n            font-weight: bold;\n            margin-right: 20rpx;\n          }\n          \n          .phone {\n            font-size: 28rpx;\n            color: #666;\n          }\n          \n          .tag {\n            display: inline-block;\n            font-size: 20rpx;\n            color: #fff;\n            background-color: #ff5500;\n            padding: 4rpx 10rpx;\n            border-radius: 4rpx;\n            margin-left: 10rpx;\n          }\n        }\n        \n        .address-detail {\n          font-size: 28rpx;\n          color: #333;\n        }\n      }\n    }\n  }\n  \n  .empty {\n    padding: 100rpx 0;\n    text-align: center;\n  }\n  \n  .bottom-btn {\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    padding: 20rpx;\n    background-color: #fff;\n    box-shadow: 0 -2rpx 10rpx rgba(0,0,0,0.05);\n  }\n  \n  .popup-content {\n    padding: 30rpx;\n    \n    .popup-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 30rpx;\n      \n      text {\n        font-size: 32rpx;\n        font-weight: bold;\n      }\n    }\n    \n    .form-box {\n      .region-select {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        height: 70rpx;\n        \n        .placeholder {\n          color: #c0c4cc;\n        }\n      }\n      \n      .btn-group {\n        margin-top: 40rpx;\n      }\n    }\n  }\n}\n</style>","import MiniProgramPage from 'E:/uniapp/Mall-Mini-Program/pages/user/address.vue'\nwx.createPage(MiniProgramPage)"],"names":["mapState","mapMutations","uni"],"mappings":"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"}