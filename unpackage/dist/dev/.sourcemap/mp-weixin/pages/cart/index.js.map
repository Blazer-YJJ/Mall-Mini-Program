{"version":3,"file":"index.js","sources":["pages/cart/index.vue","D:/install_project/HBuilderX.4.29.2024093009/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2FydC9pbmRleC52dWU"],"sourcesContent":["<template>\n  <view class=\"cart-container\">\n    <view class=\"empty\" v-if=\"cartList.length === 0\">\n      <u-empty text=\"购物车空空如也\" mode=\"cart\"></u-empty>\n      <u-button type=\"primary\" @click=\"goToHome\">去逛逛</u-button>\n    </view>\n    <block v-else>\n      <view class=\"cart-list\">\n        <view class=\"cart-item\" v-for=\"item in cartList\" :key=\"item.id\">\n          <u-checkbox v-model=\"item.checked\" @change=\"updateSelection\"></u-checkbox>\n          <image :src=\"item.image\" mode=\"aspectFill\" class=\"goods-image\"></image>\n          <view class=\"goods-info\">\n            <text class=\"goods-name\">{{ item.name }}</text>\n            <text class=\"goods-price\">¥{{ item.price }}</text>\n            <view class=\"count-box\">\n              <u-number-box v-model=\"item.count\" @change=\"(value) => updateCount(item.id, value)\"></u-number-box>\n              <u-icon name=\"trash\" size=\"40\" @click=\"removeItem(item.id)\"></u-icon>\n            </view>\n          </view>\n        </view>\n      </view>\n      <view class=\"bottom-bar\">\n        <view class=\"select-all\">\n          <u-checkbox v-model=\"isAllSelected\" @change=\"toggleSelectAll\">全选</u-checkbox>\n        </view>\n        <view class=\"total-box\">\n          <text>合计：</text>\n          <text class=\"price\">¥{{ totalPrice }}</text>\n        </view>\n        <u-button type=\"primary\" @click=\"checkout\">结算({{ selectedCount }})</u-button>\n      </view>\n    </block>\n  </view>\n</template>\n\n<script>\nimport { mapState, mapMutations } from 'vuex'\n\nexport default {\n  data() {\n    return {\n      isAllSelected: false,\n      // 添加一些模拟数据，用于在没有购物车数据时显示\n      mockData: [\n        {\n          id: 1,\n          name: '智能手机 Pro Max',\n          price: 5999,\n          image: '/static/logo.png',\n          count: 1,\n          checked: true\n        },\n        {\n          id: 2,\n          name: '超薄笔记本电脑',\n          price: 8999,\n          image: '/static/logo.png',\n          count: 1,\n          checked: true\n        },\n        {\n          id: 3,\n          name: '无线蓝牙耳机',\n          price: 999,\n          image: '/static/logo.png',\n          count: 2,\n          checked: false\n        }\n      ]\n    }\n  },\n  computed: {\n    ...mapState(['cartList', 'userInfo']),\n    // 如果购物车为空，则使用模拟数据\n    displayCartList() {\n      // 确保cartList存在再访问其length属性\n      return (this.cartList && this.cartList.length > 0) ? this.cartList : this.mockData\n    },\n    selectedCount() {\n      return this.displayCartList.filter(item => item.checked).length\n    },\n    totalPrice() {\n      return this.displayCartList\n        .filter(item => item.checked)\n        .reduce((total, item) => total + item.price * item.count, 0)\n        .toFixed(2)\n    }\n  },\n  onShow() {\n    // 页面显示时检查全选状态\n    this.updateSelection()\n  },\n  methods: {\n    ...mapMutations(['updateCartCount', 'removeFromCart', 'updateCartItemChecked', 'updateAllCartItemsChecked']),\n    goToHome() {\n      uni.switchTab({\n        url: '/pages/index/index'\n      })\n    },\n    updateSelection() {\n      this.isAllSelected = this.displayCartList.length > 0 && this.displayCartList.every(item => item.checked)\n    },\n    toggleSelectAll(value) {\n      // 使用store中的mutation更新所有商品选中状态\n      this.updateAllCartItemsChecked(value)\n      this.displayCartList.forEach(item => {\n        item.checked = value\n      })\n    },\n    updateCount(id, count) {\n      this.updateCartCount({ id, count })\n    },\n    removeItem(id) {\n      uni.showModal({\n        title: '提示',\n        content: '确定要删除该商品吗？',\n        success: (res) => {\n          if (res.confirm) {\n            this.removeFromCart(id)\n          }\n        }\n      })\n    },\n    checkout() {\n      if (!this.userInfo) {\n        uni.navigateTo({\n          url: '/pages/user/login'\n        })\n        return\n      }\n      if (this.selectedCount === 0) {\n        uni.showToast({\n          title: '请选择商品',\n          icon: 'none'\n        })\n        return\n      }\n      // 使用displayCartList而不是直接使用cartList\n      const selectedGoods = this.displayCartList.filter(item => item.checked)\n      uni.navigateTo({\n        url: `/pages/order/create?goods=${JSON.stringify(selectedGoods)}`\n      })\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.cart-container {\n  min-height: 100vh;\n  background-color: #f8f8f8;\n  padding-bottom: 120rpx;\n  .empty {\n    padding: 100rpx 40rpx;\n    text-align: center;\n    button {\n      margin-top: 40rpx;\n      width: 200rpx;\n    }\n  }\n  .cart-list {\n    .cart-item {\n      display: flex;\n      align-items: center;\n      padding: 20rpx;\n      background-color: #fff;\n      margin-bottom: 20rpx;\n      .goods-image {\n        width: 160rpx;\n        height: 160rpx;\n        margin: 0 20rpx;\n      }\n      .goods-info {\n        flex: 1;\n        .goods-name {\n          font-size: 28rpx;\n          color: #333;\n        }\n        .goods-price {\n          font-size: 32rpx;\n          color: #ff5500;\n          font-weight: bold;\n          margin: 10rpx 0;\n        }\n        .count-box {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n        }\n      }\n    }\n  }\n  .bottom-bar {\n    position: fixed;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    height: 100rpx;\n    background-color: #fff;\n    display: flex;\n    align-items: center;\n    padding: 0 20rpx;\n    .select-all {\n      margin-right: 20rpx;\n    }\n    .total-box {\n      flex: 1;\n      text-align: right;\n      margin-right: 20rpx;\n      .price {\n        color: #ff5500;\n        font-size: 36rpx;\n        font-weight: bold;\n      }\n    }\n  }\n}\n</style>","import MiniProgramPage from 'E:/uniapp/Mall-Mini-Program/pages/cart/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["mapState","mapMutations","uni"],"mappings":";;AAsCA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,eAAe;AAAA;AAAA,MAEf,UAAU;AAAA,QACR;AAAA,UACE,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,OAAO;AAAA,UACP,OAAO;AAAA,UACP,OAAO;AAAA,UACP,SAAS;AAAA,QACV;AAAA,QACD;AAAA,UACE,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,OAAO;AAAA,UACP,OAAO;AAAA,UACP,OAAO;AAAA,UACP,SAAS;AAAA,QACV;AAAA,QACD;AAAA,UACE,IAAI;AAAA,UACJ,MAAM;AAAA,UACN,OAAO;AAAA,UACP,OAAO;AAAA,UACP,OAAO;AAAA,UACP,SAAS;AAAA,QACX;AAAA,MACF;AAAA,IACF;AAAA,EACD;AAAA,EACD,UAAU;AAAA,IACR,GAAGA,uBAAS,CAAC,YAAY,UAAU,CAAC;AAAA;AAAA,IAEpC,kBAAkB;AAEhB,aAAQ,KAAK,YAAY,KAAK,SAAS,SAAS,IAAK,KAAK,WAAW,KAAK;AAAA,IAC3E;AAAA,IACD,gBAAgB;AACd,aAAO,KAAK,gBAAgB,OAAO,UAAQ,KAAK,OAAO,EAAE;AAAA,IAC1D;AAAA,IACD,aAAa;AACX,aAAO,KAAK,gBACT,OAAO,UAAQ,KAAK,OAAO,EAC3B,OAAO,CAAC,OAAO,SAAS,QAAQ,KAAK,QAAQ,KAAK,OAAO,CAAC,EAC1D,QAAQ,CAAC;AAAA,IACd;AAAA,EACD;AAAA,EACD,SAAS;AAEP,SAAK,gBAAgB;AAAA,EACtB;AAAA,EACD,SAAS;AAAA,IACP,GAAGC,cAAAA,aAAa,CAAC,mBAAmB,kBAAkB,yBAAyB,2BAA2B,CAAC;AAAA,IAC3G,WAAW;AACTC,oBAAAA,MAAI,UAAU;AAAA,QACZ,KAAK;AAAA,OACN;AAAA,IACF;AAAA,IACD,kBAAkB;AAChB,WAAK,gBAAgB,KAAK,gBAAgB,SAAS,KAAK,KAAK,gBAAgB,MAAM,UAAQ,KAAK,OAAO;AAAA,IACxG;AAAA,IACD,gBAAgB,OAAO;AAErB,WAAK,0BAA0B,KAAK;AACpC,WAAK,gBAAgB,QAAQ,UAAQ;AACnC,aAAK,UAAU;AAAA,OAChB;AAAA,IACF;AAAA,IACD,YAAY,IAAI,OAAO;AACrB,WAAK,gBAAgB,EAAE,IAAI,OAAO;AAAA,IACnC;AAAA,IACD,WAAW,IAAI;AACbA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AACf,iBAAK,eAAe,EAAE;AAAA,UACxB;AAAA,QACF;AAAA,OACD;AAAA,IACF;AAAA,IACD,WAAW;AACT,UAAI,CAAC,KAAK,UAAU;AAClBA,sBAAAA,MAAI,WAAW;AAAA,UACb,KAAK;AAAA,SACN;AACD;AAAA,MACF;AACA,UAAI,KAAK,kBAAkB,GAAG;AAC5BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,SACP;AACD;AAAA,MACF;AAEA,YAAM,gBAAgB,KAAK,gBAAgB,OAAO,UAAQ,KAAK,OAAO;AACtEA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,6BAA6B,KAAK,UAAU,aAAa,CAAC;AAAA,OAChE;AAAA,IACH;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC/IA,GAAG,WAAW,eAAe;"}